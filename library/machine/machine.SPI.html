

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Class SPI – Serial Peripheral Interface bus control (master) &mdash; MicroPython for Thunderboard Sense 1.8.2 documentation</title>
  

  
  
    <link rel="shortcut icon" href="../../_static/favicon.ico"/>
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  

  
    <link rel="stylesheet" href="../../_static/customstyle.css" type="text/css" />
  

  
        <link rel="index" title="Index"
              href="../../genindex.html"/>
        <link rel="search" title="Search" href="../../search.html"/>
    <link rel="top" title="MicroPython for Thunderboard Sense 1.8.2 documentation" href="../../index.html"/>
        <link rel="up" title="machine — Functions to control mcu peripherals" href="machine.html"/>
        <link rel="next" title="class Timer — control hardware timers" href="machine.Timer.html"/>
        <link rel="prev" title="Class Pin - control I/O pins" href="machine.Pin.html"/> 

  
  <script src="../../_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../../index.html" class="icon icon-home"> MicroPython for Thunderboard Sense
          

          
          </a>

          
            
            
              <div class="version">
                1.8
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../quickref.html">Quick reference for the Thunderboard Sense Micropython Implementation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../general.html">General information about the Thunderboard Sense</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../getting_started/index.html">Get started with MicroPython</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">MicroPython libraries</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../index.html#python-standard-libraries-and-micro-libraries">Python standard libraries and micro-libraries</a></li>
<li class="toctree-l2"><a class="reference internal" href="../index.html#micropython-specific-libraries">MicroPython-specific libraries</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html#libraries-specific-to-the-thunderboard-sense">Libraries specific to the Thunderboard Sense</a><ul class="current">
<li class="toctree-l3 current"><a class="reference internal" href="machine.html"><code class="docutils literal"><span class="pre">machine</span></code> &#8212; Functions to control mcu peripherals</a><ul class="current">
<li class="toctree-l4"><a class="reference internal" href="machine.html#reset-related-functions">Reset related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="machine.html#interrupt-related-functions">Interrupt related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="machine.html#power-related-functions">Power related functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="machine.html#miscellaneous-functions">Miscellaneous functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="machine.html#constants">Constants</a></li>
<li class="toctree-l4 current"><a class="reference internal" href="machine.html#classes">Classes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../em/em.html"><code class="docutils literal"><span class="pre">em</span></code> &#8212; Functions related to low power modes</a></li>
<li class="toctree-l3"><a class="reference internal" href="../tbsense/tbsense.html"><code class="docutils literal"><span class="pre">tbsense</span></code> &#8212; Functions related to the board</a></li>
<li class="toctree-l3"><a class="reference internal" href="../radio/radio.html"><code class="docutils literal"><span class="pre">radio</span></code> &#8212; Functions and classes related to radio operation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../reference/index.html">The MicroPython language</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../license.html">MicroPython license information</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../../contents.html">MicroPython Documentation contents</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../quickref.html">Quick reference for the Thunderboard Sense Micropython Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../general.html">General information about the Thunderboard Sense</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../getting_started/index.html">Get started with MicroPython</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../index.html">MicroPython libraries</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="../index.html#python-standard-libraries-and-micro-libraries">Python standard libraries and micro-libraries</a></li>
<li class="toctree-l3"><a class="reference internal" href="../index.html#micropython-specific-libraries">MicroPython-specific libraries</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="../index.html#libraries-specific-to-the-thunderboard-sense">Libraries specific to the Thunderboard Sense</a><ul class="current">
<li class="toctree-l4 current"><a class="reference internal" href="machine.html"><code class="docutils literal"><span class="pre">machine</span></code> &#8212; Functions to control mcu peripherals</a></li>
<li class="toctree-l4"><a class="reference internal" href="../em/em.html"><code class="docutils literal"><span class="pre">em</span></code> &#8212; Functions related to low power modes</a></li>
<li class="toctree-l4"><a class="reference internal" href="../tbsense/tbsense.html"><code class="docutils literal"><span class="pre">tbsense</span></code> &#8212; Functions related to the board</a></li>
<li class="toctree-l4"><a class="reference internal" href="../radio/radio.html"><code class="docutils literal"><span class="pre">radio</span></code> &#8212; Functions and classes related to radio operation</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../../reference/index.html">The MicroPython language</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../index.html">MicroPython for Thunderboard Sense</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../index.html">MicroPython libraries</a> &raquo;</li>
      
          <li><a href="machine.html"><code class="docutils literal"><span class="pre">machine</span></code> &#8212; Functions to control mcu peripherals</a> &raquo;</li>
      
    <li>Class SPI &#8211; Serial Peripheral Interface bus control (master)</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../../_sources/library/machine/machine.SPI.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="class-spi-serial-peripheral-interface-bus-control-master">
<span id="machine-spi"></span><h1>Class SPI &#8211; Serial Peripheral Interface bus control (master)<a class="headerlink" href="#class-spi-serial-peripheral-interface-bus-control-master" title="Permalink to this headline">¶</a></h1>
<p>SPI is a synchronous serial protocol that is driven by a master.
At the physical level, a bus consists of 3 lines, SCK, MOSI and MISO.
Multiple devices can share the same bus. Each device should have
a separate 4th signal, SS (Slave Select), to select a particular
device on a bus with which communication takes place. Management of
an SS signal should happen in user code (with the <a class="reference internal" href="machine.Pin.html#machine.machine.Pin" title="machine.machine.Pin"><code class="xref py py-class docutils literal"><span class="pre">machine.Pin</span></code></a> class).</p>
<p>This class only support SPI transactions as master. It also supports
a software implementation (bitbanging) implementation of SPI by
using a negative ID.</p>
<p>When using positive IDs note that the id corresponds to a
physical USART peripheral on the device. This means
that using <code class="docutils literal"><span class="pre">SPI(0)</span></code> causes <code class="docutils literal"><span class="pre">UART(0)</span></code> to be unavailable.</p>
<p>On the Thunderboard Sense, <code class="docutils literal"><span class="pre">SPI(0)</span></code> is used for printing the REPL.
Configuring the use of this peripheral as a SPI peripheral looses all
printing functionality as well as the command line.
<code class="docutils literal"><span class="pre">SPI(1)</span></code> is already initialized as a SPI-bus with the following pins:
MOSI=PC6, MISO=PC7 and SCK=PC8. It is initialized to a baudrate of 8000000.
<code class="docutils literal"><span class="pre">SPI(1)</span></code> can be utilized as is. If the configuration is changed,
the flash as well as the IMU will be unavailable. The bus can be reset to the
initial state with the function
<a class="reference internal" href="../tbsense/tbsense.html#tbsense.reinit_peripherals" title="tbsense.reinit_peripherals"><code class="xref py py-func docutils literal"><span class="pre">tbsense.reinit_peripherals()</span></code></a>.</p>
<p>Example:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">machine</span> <span class="k">import</span> <span class="n">SPI</span><span class="p">,</span> <span class="n">Pin</span>

<span class="c1">#Initialize peripheral and SS-pin</span>
<span class="n">spi</span> <span class="o">=</span> <span class="n">SPI</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">sck</span><span class="o">=</span><span class="s2">&quot;PC8&quot;</span><span class="p">,</span> <span class="n">mosi</span><span class="o">=</span><span class="s2">&quot;PC6&quot;</span><span class="p">,</span> <span class="n">miso</span><span class="o">=</span><span class="s2">&quot;PC7&quot;</span><span class="p">)</span>
<span class="n">ss_pin</span> <span class="o">=</span> <span class="n">Pin</span><span class="p">(</span><span class="s2">&quot;PC9&quot;</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">OUT</span><span class="p">,</span> <span class="n">Pin</span><span class="o">.</span><span class="n">PULL_NONE</span><span class="p">)</span> <span class="c1">#Slave associated with pin PC9</span>

<span class="c1">#Prepare transaction data</span>
<span class="n">buf</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="s2">&quot;EFM32&quot;</span><span class="p">)</span>

<span class="c1">#Perform transaction</span>
<span class="n">ss_pin</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<span class="n">spi</span><span class="o">.</span><span class="n">write_readinto</span><span class="p">(</span><span class="n">buf</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
<span class="n">ss_pin</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Received: &quot;</span><span class="p">,</span> <span class="n">buf</span><span class="p">)</span>
</pre></div>
</div>
<div class="section" id="constructors">
<h2>Constructors<a class="headerlink" href="#constructors" title="Permalink to this headline">¶</a></h2>
<dl class="class">
<dt id="machine.SPI">
<em class="property">class </em><code class="descclassname">machine.</code><code class="descname">SPI</code><span class="sig-paren">(</span><em>id</em>, <em>...</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI" title="Permalink to this definition">¶</a></dt>
<dd><p>Construct an SPI object on the peripheral associated with <code class="docutils literal"><span class="pre">id</span></code>.
The values of <code class="docutils literal"><span class="pre">id</span></code> are integers from 0 and up for a hardware SPI peripheral.
The number of available hardware SPI peripherals depend on the underlying hardware.
A negative value gives a software (bitbanging) implementation of SPI.</p>
<p>With no additional parameters, the SPI object is created, but not initialized (it
retains the settings from last initialization). If any more arguments are given, the bus
is initialized. See <code class="docutils literal"><span class="pre">init</span></code> for the parameters for initialization.</p>
</dd></dl>

</div>
<div class="section" id="methods">
<h2>Methods<a class="headerlink" href="#methods" title="Permalink to this headline">¶</a></h2>
<dl class="method">
<dt id="machine.SPI.init">
<code class="descclassname">SPI.</code><code class="descname">init</code><span class="sig-paren">(</span><em>baudrate=1000000</em>, <em>*</em>, <em>polarity=0</em>, <em>phase=0</em>, <em>bits=8</em>, <em>firstbit=SPI.MSB</em>, <em>sck=None</em>, <em>mosi=None</em>, <em>miso=None</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize the SPI peripheral with the given parameters:</p>
<blockquote>
<div><ul class="simple">
<li><code class="docutils literal"><span class="pre">baudrate</span></code> is the SCK clock rate.</li>
<li><code class="docutils literal"><span class="pre">`polarity</span></code> can be either 0 or 1 and is the level the idle clock line sits at.</li>
<li><code class="docutils literal"><span class="pre">phase</span></code> can be either 0 or 1 to sample data on the first or second clock edge respectively.</li>
<li><code class="docutils literal"><span class="pre">bits</span></code> is the width in bits of each transfer. It can be an arbitrary size between 4 and 16 bits.</li>
<li><code class="docutils literal"><span class="pre">firstbit</span></code> decides if the most or the least significant bit is sent first. Can be either <code class="docutils literal"><span class="pre">SPI.MSB</span></code> or <code class="docutils literal"><span class="pre">SPI.LSB</span></code>.</li>
<li><code class="docutils literal"><span class="pre">sck</span></code>, <code class="docutils literal"><span class="pre">mosi</span></code>, <code class="docutils literal"><span class="pre">miso</span></code> are the pin id or objects (see <a class="reference internal" href="machine.Pin.html#machine.machine.Pin" title="machine.machine.Pin"><code class="xref py py-class docutils literal"><span class="pre">machine.Pin</span></code></a>).</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="method">
<dt id="machine.SPI.deinit">
<code class="descclassname">SPI.</code><code class="descname">deinit</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI.deinit" title="Permalink to this definition">¶</a></dt>
<dd><p>Turn off the SPI bus.</p>
</dd></dl>

<dl class="method">
<dt id="machine.SPI.read">
<code class="descclassname">SPI.</code><code class="descname">read</code><span class="sig-paren">(</span><em>nbytes</em>, <em>write=0x00</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI.read" title="Permalink to this definition">¶</a></dt>
<dd><p>Read a number of bytes specified by <code class="docutils literal"><span class="pre">nbytes</span></code> while continously writing
the single byte given by <code class="docutils literal"><span class="pre">write</span></code>.
Returns a <code class="docutils literal"><span class="pre">bytes</span></code> object with the data that was read.</p>
</dd></dl>

<dl class="method">
<dt id="machine.SPI.readinto">
<code class="descclassname">SPI.</code><code class="descname">readinto</code><span class="sig-paren">(</span><em>buf</em>, <em>write=0x00</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI.readinto" title="Permalink to this definition">¶</a></dt>
<dd><p>Read into the buffer specified by <code class="docutils literal"><span class="pre">buf</span></code> while continously writing
the single byte given by <code class="docutils literal"><span class="pre">`write</span></code>. This function is safe from an
interrupt context.
Returns <code class="docutils literal"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="machine.SPI.write">
<code class="descclassname">SPI.</code><code class="descname">write</code><span class="sig-paren">(</span><em>buf</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI.write" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the bytes contained in <code class="docutils literal"><span class="pre">buf</span></code>. If <code class="docutils literal"><span class="pre">bits</span></code> during initialization is larger than
8, the word is sent as [<code class="docutils literal"><span class="pre">bits</span></code> - 8 LSB of byte[2*n+1], byte[2*n]].
Returns <code class="docutils literal"><span class="pre">None</span></code>.</p>
</dd></dl>

<dl class="method">
<dt id="machine.SPI.write_readinto">
<code class="descclassname">SPI.</code><code class="descname">write_readinto</code><span class="sig-paren">(</span><em>write_buf</em>, <em>read_buf</em><span class="sig-paren">)</span><a class="headerlink" href="#machine.SPI.write_readinto" title="Permalink to this definition">¶</a></dt>
<dd><p>Write the bytes from <code class="docutils literal"><span class="pre">write_buf</span></code> while reading into <code class="docutils literal"><span class="pre">read_buf</span></code>. The buffers
can be the same or different, but both buffers must have the same length.
Returns <code class="docutils literal"><span class="pre">None</span></code>.</p>
</dd></dl>

</div>
<div class="section" id="constants">
<h2>Constants<a class="headerlink" href="#constants" title="Permalink to this headline">¶</a></h2>
<dl class="data">
<dt id="machine.SPI.MSB">
<code class="descclassname">SPI.</code><code class="descname">MSB</code><a class="headerlink" href="#machine.SPI.MSB" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the first bit to be the most significant bit.</p>
</dd></dl>

<dl class="data">
<dt id="machine.SPI.LSB">
<code class="descclassname">SPI.</code><code class="descname">LSB</code><a class="headerlink" href="#machine.SPI.LSB" title="Permalink to this definition">¶</a></dt>
<dd><p>Set the last bit to be the most significant bit.</p>
</dd></dl>

</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="machine.Timer.html" class="btn btn-neutral float-right" title="class Timer — control hardware timers" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="machine.Pin.html" class="btn btn-neutral" title="Class Pin - control I/O pins" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, Damien P. George, Paul Sokolovsky, Thomas F. Koren..
      Last updated on 16 Apr 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../../',
            VERSION:'1.8.2',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../../_static/jquery.js"></script>
      <script type="text/javascript" src="../../_static/underscore.js"></script>
      <script type="text/javascript" src="../../_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="../../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>